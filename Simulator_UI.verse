using { /Verse.org/Simulation }
using { /Fortnite.com/Devices }
using { /Fortnite.com/UI }
using { /UnrealEngine.com/Temporary/UI }
using { /UnrealEngine.com/Temporary/SpatialMath }

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SIMULATOR UI - Interface utilisateur et HUD
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

#â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# HUD PRINCIPAL (Affichage permanent)
#â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
simulator_hud := class(creative_device):
    @editable
    SnowHUD : hud_message_device = hud_message_device{}

    @editable
    LevelHUD : hud_message_device = hud_message_device{}

    @editable
    XPBarHUD : hud_message_device = hud_message_device{}

    @editable
    RebirthHUD : hud_message_device = hud_message_device{}

    @editable
    ZoneHUD : hud_message_device = hud_message_device{}

    @editable
    DamageHUD : hud_message_device = hud_message_device{}

    @editable
    UpdateInterval : float = 0.1

    # Messages localisÃ©s
    SnowMsg<localizes>(Amount : string) : message = "â„ {Amount}"
    LevelMsg<localizes>(Level : int) : message = "Lv. {Level}"
    XPMsg<localizes>(Current : float, Required : float, Percent : int) : message = "XP: {Percent}%"
    RebirthMsg<localizes>(Count : int) : message = "â­ Rebirth: {Count}"
    ZoneMsg<localizes>(ZoneName : string) : message = "ğŸ“ {ZoneName}"
    DamageMsg<localizes>(Damage : string) : message = "âš” {Damage} DMG"

    OnBegin<override>()<suspends> : void =
        # DÃ©marre la boucle de mise Ã  jour
        loop:
            Sleep(UpdateInterval)
            UpdateHUD()

    UpdateHUD() : void =
        for (Player : GetPlayspace().GetPlayers()):
            UpdatePlayerHUD(Player)

    UpdatePlayerHUD(Player : player) : void =
        if (Data := GetFullData(Player)):
            # Neige
            SnowFormatted := FormatNumber(Data.Snow)
            SnowHUD.SetText(SnowMsg(SnowFormatted))
            SnowHUD.Show(Player)

            # Niveau
            LevelHUD.SetText(LevelMsg(Data.Level))
            LevelHUD.Show(Player)

            # XP
            XPRequired := GetXPForLevel(Data.Level)
            XPPercent := (Data.CurrentXP / XPRequired) * 100.0
            if (Percent := Int[XPPercent]):
                XPBarHUD.SetText(XPMsg(Data.CurrentXP, XPRequired, Percent))
                XPBarHUD.Show(Player)

            # Rebirth
            RebirthHUD.SetText(RebirthMsg(Data.RebirthCount))
            RebirthHUD.Show(Player)

            # Zone
            if (ZoneConfig := GetZoneConfig(Data.CurrentZoneID)):
                ZoneHUD.SetText(ZoneMsg(ZoneConfig.ZoneName))
                ZoneHUD.Show(Player)

            # DÃ©gÃ¢ts
            if (SimPlayer := GetSimulatorPlayer(Player)):
                DamageFormatted := FormatNumber(SimPlayer.TotalDamage)
                DamageHUD.SetText(DamageMsg(DamageFormatted))
                DamageHUD.Show(Player)

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# FLOATING DAMAGE NUMBERS - Nombres de dÃ©gÃ¢ts flottants
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
damage_number_spawner := class(creative_device):
    @editable
    DamageBillboards : []billboard_device = array{}  # Pool de billboards

    @editable
    CritDamageBillboards : []billboard_device = array{}  # Pour les crits

    @editable
    FloatDistance : float = 200.0

    @editable
    FloatDuration : float = 1.0

    var NextBillboardIndex : int = 0
    var NextCritIndex : int = 0

    DamageMsg<localizes>(Damage : int) : message = "{Damage}"
    CritMsg<localizes>(Damage : int) : message = "CRIT! {Damage}"

    #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # SPAWN UN NOMBRE DE DÃ‰GÃ‚TS
    #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    SpawnDamageNumber(Position : vector3, Damage : float, IsCrit : logic) : void =
        if (DamageInt := Int[Damage]):
            if (IsCrit?):
                if (CritDamageBillboards.Length > 0):
                    Index := NextCritIndex mod CritDamageBillboards.Length
                    set NextCritIndex += 1
                    if (Billboard := CritDamageBillboards[Index]):
                        Billboard.SetText(CritMsg(DamageInt))
                        spawn{AnimateDamageNumber(Billboard, Position)}
            else:
                if (DamageBillboards.Length > 0):
                    Index := NextBillboardIndex mod DamageBillboards.Length
                    set NextBillboardIndex += 1
                    if (Billboard := DamageBillboards[Index]):
                        Billboard.SetText(DamageMsg(DamageInt))
                        spawn{AnimateDamageNumber(Billboard, Position)}

    AnimateDamageNumber(Billboard : billboard_device, StartPosition : vector3)<suspends> : void =
        # Note: Les billboards UEFN ne supportent pas le dÃ©placement direct
        # Cette fonction est un placeholder pour l'animation
        # Dans un vrai projet, on utiliserait des props ou un systÃ¨me custom

        # Affiche pendant la durÃ©e
        Sleep(FloatDuration)

        # Cache le billboard
        HideMsg : message = ""
        Billboard.SetText(HideMsg)

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SNOW GAIN POPUP - Popup de gain de neige
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
snow_gain_display := class(creative_device):
    @editable
    GainHUD : hud_message_device = hud_message_device{}

    @editable
    DisplayDuration : float = 1.5

    var IsShowing : logic = false
    var PendingGains : float = 0.0

    GainMsg<localizes>(Amount : string) : message = "+{Amount} â„"

    #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # AFFICHE UN GAIN DE NEIGE
    #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ShowGain(Player : player, Amount : float) : void =
        set PendingGains += Amount
        if (not IsShowing?):
            spawn{DisplayGainRoutine(Player)}

    DisplayGainRoutine(Player : player)<suspends> : void =
        set IsShowing = true

        # Affiche les gains accumulÃ©s
        FormattedAmount := FormatNumber(PendingGains)
        GainHUD.SetText(GainMsg(FormattedAmount))
        GainHUD.Show(Player)

        # Reset les gains accumulÃ©s
        set PendingGains = 0.0

        # Attend la durÃ©e d'affichage
        Sleep(DisplayDuration)

        # Cache
        GainHUD.Hide(Player)
        set IsShowing = false

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# LEVEL UP CELEBRATION - Animation de level up
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
level_up_celebration := class(creative_device):
    @editable
    LevelUpHUD : hud_message_device = hud_message_device{}

    @editable
    LevelUpVFX : vfx_spawner_device = vfx_spawner_device{}

    @editable
    LevelUpAudio : audio_player_device = audio_player_device{}

    @editable
    DisplayDuration : float = 3.0

    LevelUpMsg<localizes>(Level : int) : message = "ğŸ‰ LEVEL UP! ğŸ‰ Level {Level}"

    #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # DÃ‰CLENCHE LA CÃ‰LÃ‰BRATION
    #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    TriggerCelebration(Player : player, NewLevel : int) : void =
        LevelUpHUD.SetText(LevelUpMsg(NewLevel))
        LevelUpHUD.Show(Player)
        LevelUpVFX.Restart()
        LevelUpAudio.Play()

        spawn{HideAfterDelay(Player)}

    HideAfterDelay(Player : player)<suspends> : void =
        Sleep(DisplayDuration)
        LevelUpHUD.Hide(Player)

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PET OBTAINED POPUP - Popup d'obtention de pet
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
pet_obtained_display := class(creative_device):
    @editable
    ObtainedHUD : hud_message_device = hud_message_device{}

    @editable
    RarityHUD : hud_message_device = hud_message_device{}

    @editable
    CommonVFX : vfx_spawner_device = vfx_spawner_device{}

    @editable
    RareVFX : vfx_spawner_device = vfx_spawner_device{}

    @editable
    EpicVFX : vfx_spawner_device = vfx_spawner_device{}

    @editable
    LegendaryVFX : vfx_spawner_device = vfx_spawner_device{}

    @editable
    MythicVFX : vfx_spawner_device = vfx_spawner_device{}

    @editable
    DisplayDuration : float = 3.0

    ObtainedMsg<localizes>(PetName : string) : message = "NEW PET: {PetName}"
    RarityMsg<localizes>(Rarity : string) : message = "[ {Rarity} ]"

    #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # AFFICHE L'OBTENTION D'UN PET
    #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ShowPetObtained(Player : player, PetName : string, Rarity : pet_rarity) : void =
        ObtainedHUD.SetText(ObtainedMsg(PetName))
        ObtainedHUD.Show(Player)

        RarityName := GetRarityName(Rarity)
        RarityHUD.SetText(RarityMsg(RarityName))
        RarityHUD.Show(Player)

        # VFX selon la raretÃ©
        case (Rarity):
            pet_rarity.Common => CommonVFX.Restart()
            pet_rarity.Rare => RareVFX.Restart()
            pet_rarity.Epic => EpicVFX.Restart()
            pet_rarity.Legendary => LegendaryVFX.Restart()
            pet_rarity.Mythic => MythicVFX.Restart()

        spawn{HideAfterDelay(Player)}

    HideAfterDelay(Player : player)<suspends> : void =
        Sleep(DisplayDuration)
        ObtainedHUD.Hide(Player)
        RarityHUD.Hide(Player)

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# REBIRTH CELEBRATION - CÃ©lÃ©bration de rebirth
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
rebirth_celebration := class(creative_device):
    @editable
    RebirthHUD : hud_message_device = hud_message_device{}

    @editable
    BonusHUD : hud_message_device = hud_message_device{}

    @editable
    RebirthVFX : vfx_spawner_device = vfx_spawner_device{}

    @editable
    RebirthAudio : audio_player_device = audio_player_device{}

    @editable
    ScreenFlash : cinematic_sequence_device = cinematic_sequence_device{}

    @editable
    DisplayDuration : float = 5.0

    RebirthTitleMsg<localizes>(Level : int) : message = "â­ REBIRTH {Level} â­"
    BonusesMsg<localizes>(DMG : float, SPD : float, CURR : float) : message = "+{DMG}% DMG | +{SPD}% Speed | +{CURR}% Snow"

    #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # DÃ‰CLENCHE LA CÃ‰LÃ‰BRATION DE REBIRTH
    #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    TriggerCelebration(Player : player, RebirthLevel : int, DmgBonus : float, SpdBonus : float, CurrBonus : float) : void =
        RebirthHUD.SetText(RebirthTitleMsg(RebirthLevel))
        RebirthHUD.Show(Player)

        BonusHUD.SetText(BonusesMsg(DmgBonus, SpdBonus, CurrBonus))
        BonusHUD.Show(Player)

        RebirthVFX.Restart()
        RebirthAudio.Play()
        ScreenFlash.Play()

        spawn{HideAfterDelay(Player)}

    HideAfterDelay(Player : player)<suspends> : void =
        Sleep(DisplayDuration)
        RebirthHUD.Hide(Player)
        BonusHUD.Hide(Player)

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# XP BAR VISUAL (Barre de progression XP)
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
xp_bar_visual := class(creative_device):
    @editable
    BarSegments : []creative_prop = array{}  # 10 segments de barre

    @editable
    UpdateInterval : float = 0.25

    OnBegin<override>()<suspends> : void =
        loop:
            Sleep(UpdateInterval)
            UpdateBars()

    UpdateBars() : void =
        for (Player : GetPlayspace().GetPlayers()):
            if (Data := GetFullData(Player)):
                XPRequired := GetXPForLevel(Data.Level)
                XPPercent := Data.CurrentXP / XPRequired

                # Active les segments proportionnellement
                TotalSegments := BarSegments.Length
                ActiveSegments := Int[XPPercent * TotalSegments]

                for (Index := 0..TotalSegments - 1):
                    if (Segment := BarSegments[Index]):
                        if (ActiveSegmentCount := ActiveSegments):
                            if (Index < ActiveSegmentCount):
                                # Segment actif - visible
                                ShowSegment(Segment)
                            else:
                                # Segment inactif - cachÃ© ou transparent
                                HideSegment(Segment)

    ShowSegment(Prop : creative_prop) : void =
        # Dans un vrai systÃ¨me, on changerait la couleur/visibilitÃ©
        pass

    HideSegment(Prop : creative_prop) : void =
        # Dans un vrai systÃ¨me, on changerait la couleur/visibilitÃ©
        pass

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# COMBO DISPLAY - Affichage du combo (hits successifs)
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
combo_display := class(creative_device):
    @editable
    ComboHUD : hud_message_device = hud_message_device{}

    @editable
    ComboVFX : vfx_spawner_device = vfx_spawner_device{}

    @editable
    ComboTimeout : float = 2.0  # Temps avant reset du combo

    var PlayerCombos : [player]int = map{}
    var LastHitTime : [player]float = map{}

    ComboMsg<localizes>(Count : int) : message = "COMBO x{Count}"

    OnBegin<override>()<suspends> : void =
        # Le combo serait incrÃ©mentÃ© par le systÃ¨me de breakables
        loop:
            Sleep(0.1)
            CheckComboTimeouts()

    IncrementCombo(Player : player) : void =
        CurrentCombo := 0
        if (Combo := PlayerCombos[Player]):
            set CurrentCombo = Combo

        set CurrentCombo += 1
        if (set PlayerCombos[Player] = CurrentCombo) {}

        # Affiche le combo
        if (CurrentCombo > 1):
            ComboHUD.SetText(ComboMsg(CurrentCombo))
            ComboHUD.Show(Player)

            if (CurrentCombo mod 10 = 0):  # VFX tous les 10 combos
                ComboVFX.Restart()

    ResetCombo(Player : player) : void =
        if (set PlayerCombos[Player] = 0) {}
        ComboHUD.Hide(Player)

    CheckComboTimeouts() : void =
        # Dans un vrai systÃ¨me, on comparerait avec le temps actuel
        pass

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# NOTIFICATION SYSTEM - SystÃ¨me de notifications
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
notification_system := class(creative_device):
    @editable
    NotificationHUD : hud_message_device = hud_message_device{}

    @editable
    DefaultDuration : float = 3.0

    var NotificationQueue : []tuple(Player : player, Message : message, Duration : float) = array{}
    var IsShowingNotification : logic = false

    OnBegin<override>()<suspends> : void =
        loop:
            Sleep(0.1)
            ProcessQueue()

    #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # AJOUTE UNE NOTIFICATION Ã€ LA QUEUE
    #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    QueueNotification(Player : player, Msg : message, Duration : float) : void =
        set NotificationQueue += array{(Player := Player, Message := Msg, Duration := Duration)}

    ProcessQueue() : void =
        if (not IsShowingNotification?):
            if (NotificationQueue.Length > 0):
                if (Notification := NotificationQueue[0]):
                    spawn{ShowNotification(Notification.Player, Notification.Message, Notification.Duration)}
                    # Retire de la queue
                    var NewQueue : []tuple(Player : player, Message : message, Duration : float) = array{}
                    for (Index := 1..NotificationQueue.Length - 1):
                        if (N := NotificationQueue[Index]):
                            set NewQueue += array{N}
                    set NotificationQueue = NewQueue

    ShowNotification(Player : player, Msg : message, Duration : float)<suspends> : void =
        set IsShowingNotification = true
        NotificationHUD.SetText(Msg)
        NotificationHUD.Show(Player)
        Sleep(Duration)
        NotificationHUD.Hide(Player)
        set IsShowingNotification = false
